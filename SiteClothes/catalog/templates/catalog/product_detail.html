{% extends "catalog/base.html" %}
{% load static %}

{% block content %}
<section class="section section-product-detail">
    <div class="fake fake2"><br></div>
    <div class="product-detail-container">

        <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
        <div class="product-gallery">
            <div class="main-image">
                <img src="{{ product.imgg.url }}" alt="{{ product.title }}" class="zoomable" id="mainProductImage"
                     style="{% if not product.is_in_stock %}filter: grayscale(100%); opacity: 0.6;{% endif %}">
            </div>
        </div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–µ -->
        <div class="product-info">
            <nav class="breadcrumbs">
                <a href="{% url 'catalog:view_product' %}">–ö–∞—Ç–∞–ª–æ–≥</a> >
                <a href="{% url 'catalog:view_product' %}?category={{ product.catt.id }}">{{ product.catt }}</a> >
                <span>{{ product.title }}</span>
            </nav>

            <h1 class="product-title">{{ product.title }}</h1>
            <div class="product-brand-rating">
                <span class="brand">–ë—Ä–µ–Ω–¥: {{ product.brendd }}</span>
            </div>

            <div class="price-block">
                <span class="current-price">{{ product.summ|floatformat:"0" }} ‚ÇΩ</span>
                {% if product.old_price %}
                <span class="old-price">{{ product.old_price }} ‚ÇΩ</span>
                <span class="discount-badge">-{{ product.discount_percent }}%</span>
                {% endif %}
            </div>

            {% if not product.is_in_stock %}
                <div style="background-color: #f8d7da; color: #721c24; padding: 10px 15px; border-radius: 6px; margin-bottom: 1.5rem; text-align: center; font-weight: 600;">
                    –¢–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è
                </div>
            {% endif %}

            <div class="size-selector">
                <div class="size-header">
                    <span class="option-title">–†–∞–∑–º–µ—Ä:</span>
                </div>
                <div class="size-options" id="sizeOptionsContainer">
                    {% for stock_item in product.stock_set.all %}
                        {% if stock_item.quantity > 0 %}
                            <button class="size-option js-size-select" data-size-id="{{ stock_item.size.id }}">
                                {{ stock_item.size.name }}
                            </button>
                        {% endif %}
                    {% endfor %}
                </div>
                <div class="size-error" id="sizeErrorMessage"></div>
            </div>

             <div class="action-buttons">
                {% if user.is_authenticated %}
                    <button class="add-to-cart-btn" id="addToCartBtn"
                            {% if not product.is_in_stock %}disabled{% else %}disabled{% endif %}
                            data-product-id="{{ product.id }}"
                            data-product-title="{{ product.title|addslashes }}"
                            data-url-template="{% url 'catalog:add_to_cart' 0 %}">
                        {% if product.is_in_stock %}
                            <span class="cart-icon">üõí</span> –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                        {% else %}
                            –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                        {% endif %}
                    </button>
                    <button class="wishlist-btn {% if product_in_favorites %}in-favorites{% endif %}"
                            id="favorite-btn-{{ product.id }}"
                            onclick="toggleFavorite({{ product.id }}, this, '{{ csrf_token }}')">
                        <span class="heart-icon">‚ù§</span>
                        <span class="favorite-text">{% if product_in_favorites %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º{% else %}–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ{% endif %}</span>
                    </button>
                {% else %}
                    <a href="{% url 'login' %}?next={{ request.path|urlencode }}" class="add-to-cart-btn">
                         <span class="cart-icon">üõí</span>
                         <span>–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å</span>
                    </a>
                     <a href="{% url 'login' %}?next={{ request.path|urlencode }}" class="wishlist-btn">
                        <span class="heart-icon">‚ù§</span>
                        <span>–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                    </a>
                {% endif %}
            </div>

            <div class="delivery-info">
                <div class="delivery-option">
                    <span class="delivery-icon">üöö</span>
                    <div>
                        <strong>–î–æ—Å—Ç–∞–≤–∫–∞</strong>
                        <p>–°–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è...</p>
                    </div>
                </div>
                <div class="delivery-option">
                    <span class="delivery-icon">üè™</span>
                    <div>
                        <strong>–°–∞–º–æ–≤—ã–≤–æ–∑</strong>
                        <p>–°–µ–≥–æ–¥–Ω—è - –±–µ—Å–ø–ª–∞—Ç–Ω–æ</p>
                    </div>
                </div>
            </div>

            <div class="product-meta">
                <div class="meta-item"><span class="meta-title">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span><span>{{ product.catt }}</span></div>
                <div class="meta-item"><span class="meta-title">–ü–æ–ª:</span><span>{{ product.genderr }}</span></div>
                <div class="meta-item"><span class="meta-title">–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</span><span>{{ product.display_material }}</span></div>
                <div class="meta-item"><span class="meta-title">–ê—Ä—Ç–∏–∫—É–ª:</span><span>CLOSE-{{ product.id }}</span></div>
            </div>
        </div>
    </div>

    <!-- –¢–∞–±—ã -->
    <div class="product-tabs">
        <div class="tabs-header">
            <button class="tab-btn active js-tab-btn" data-tab="description">–û–ø–∏—Å–∞–Ω–∏–µ</button>
            <button class="tab-btn js-tab-btn" data-tab="specs">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</button>
            <button class="tab-btn js-tab-btn" data-tab="reviews">–û—Ç–∑—ã–≤—ã</button>
        </div>
        <div class="tab-content active" id="description-content">
            <h3 class="product-disc">–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</h3>
            <p>{{ product.description|default:"–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å. –í—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å –æ –∫–∞—á–µ—Å—Ç–≤–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è—Ö –∫—Ä–æ—è, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö –ø–æ —É—Ö–æ–¥—É –∏ –¥—Ä—É–≥–∏—Ö –≤–∞–∂–Ω—ã—Ö –¥–µ—Ç–∞–ª—è—Ö." }}</p>
        </div>
        <div class="tab-content" id="specs-content">
            <h3 class="product-disc">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
            <table class="specs-table">
                <tr><td>–ë—Ä–µ–Ω–¥</td><td>{{ product.brendd }}</td></tr>
                <tr><td>–°–æ—Å—Ç–∞–≤</td><td>{{ product.display_material }}</td></tr>
                <tr><td>–¶–≤–µ—Ç</td><td>{{ product.colorr }}</td></tr>
                <tr><td>–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</td><td>{{ product.countryy|default:"–ö–∏—Ç–∞–π" }}</td></tr>
            </table>
        </div>
        <div class="tab-content" id="reviews-content">
            <h3 class="product-disc">–û—Ç–∑—ã–≤—ã</h3>
            <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –æ—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π.</p>
        </div>
    </div>
</section>
{% endblock %}

{% block page_scripts %}
<script src="{% static 'js/product-detail.js' %}"></script>
{% endblock %}